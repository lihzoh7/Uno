<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SPACE GLASS - Prizes</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:navy;
  color:white;
  display:flex;
  justify-content:center;
}
#container {
  width:600px;
  margin-top:20px;
  padding:20px;
}
#back {
  font-size:20px;
  cursor:pointer;
  margin-bottom:15px;
}
.schedule {
  display:grid;
  grid-template-columns: 100px repeat(7,1fr);
  gap:5px;
  margin-bottom:20px;
}
.schedule div {
  padding:5px;
  text-align:center;
  border:1px solid #fff;
}
.schedule .time {
  font-weight:bold;
}
.schedule .past {
  background:#a00;
}
.schedule .ongoing {
  background:#0a0;
}
.medals {
  margin-top:20px;
}
.medals div {
  display:flex;
  justify-content:space-between;
  padding:5px 10px;
  border-bottom:1px solid #444;
}
.medals .medal-name {
  font-weight:bold;
}
.hidden { display:none; }
</style>
</head>
<body>

<div id="container">
  <div id="back" onclick="window.location.href='main-menu.html'">‚Ü©Ô∏è Back</div>

  <div class="schedule" id="schedule"></div>

  <div class="medals" id="medals">
    <div>ü•á <span id="goldName">-</span> R<span id="goldAmount">0</span></div>
    <div>ü•à <span id="silverName">-</span> R<span id="silverAmount">0</span></div>
    <div>ü•â <span id="bronzeName">-</span> R<span id="bronzeAmount">0</span></div>
  </div>

  <!-- Admin placeholder for input -->
  <div id="adminPlaceholder" class="hidden">
    <h3>Admin Input</h3>
    <!-- Can implement form fields here -->
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, get, onValue, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBqJTLjxhZBCsvjrTH_cG0fkXlElG6BqTg",
  authDomain: "tose-ccf8f.firebaseapp.com",
  databaseURL: "https://tose-ccf8f-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "tose-ccf8f",
  storageBucket: "tose-ccf8f.firebasestorage.app",
  messagingSenderId: "475447495901",
  appId: "1:475447495901:web:9189276a162a3680afdf34"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const scheduleEl = document.getElementById('schedule');
const medalsEl = document.getElementById('medals');

// Example: game times (6:00-17:30 & 18:00-05:30)
const gameTimes = [
  { from:"06:00", to:"17:30" },
  { from:"18:00", to:"05:30" }
];
const days = ["Time","Mon","Tue","Wed","Thu","Fri","Sat","Sun"];

// Render schedule header
days.forEach(d=>{
  const div = document.createElement('div');
  div.innerText=d;
  scheduleEl.appendChild(div);
});

// Render schedule rows (2 rows per day)
gameTimes.forEach((time)=>{
  const timeDiv = document.createElement('div');
  timeDiv.className='time';
  timeDiv.innerText = `${time.from}-${time.to}`;
  scheduleEl.appendChild(timeDiv);
  for(let i=0;i<7;i++){
    const dayDiv = document.createElement('div');
    dayDiv.dataset.day = i;
    dayDiv.dataset.from = time.from;
    dayDiv.dataset.to = time.to;
    scheduleEl.appendChild(dayDiv);
  }
});

// Function to update schedule color based on current time
function updateSchedule(){
  const now = new Date();
  const dayIndex = now.getDay(); // Sunday=0
  const hour = now.getHours();
  const minutes = now.getMinutes();

  document.querySelectorAll('.schedule div[data-day]').forEach(div=>{
    const fromParts = div.dataset.from.split(":");
    const toParts = div.dataset.to.split(":");
    const fromH = parseInt(fromParts[0]), fromM = parseInt(fromParts[1]);
    const toH = parseInt(toParts[0]), toM = parseInt(toParts[1]);
    let ongoing=false, past=false;

    const nowMinutes = hour*60+minutes;
    const fromMinutes = fromH*60+fromM;
    const toMinutes = toH*60+toM + (toH<fromH?1440:0); // handle overnight

    if(nowMinutes>=fromMinutes && nowMinutes<=toMinutes) ongoing=true;
    else if(nowMinutes>toMinutes) past=true;

    div.classList.remove('ongoing','past');
    if(ongoing) div.classList.add('ongoing');
    else if(past) div.classList.add('past');
  });
}

// Initial schedule color
updateSchedule();
setInterval(updateSchedule,60000); // every 1 min

// Load top 3 prizes dynamically from leaderboard
async function loadMedals(){
  const snap = await get(ref(db,'leaderboard/current'));
  const data = snap.val()||{};
  let arr=[];
  for(const uid in data){
    arr.push({uid, score:data[uid].score});
  }
  arr.sort((a,b)=>b.score-a.score);
  const top3 = arr.slice(0,3);

  const goldName = document.getElementById('goldName');
  const silverName = document.getElementById('silverName');
  const bronzeName = document.getElementById('bronzeName');
  const goldAmount = document.getElementById('goldAmount');
  const silverAmount = document.getElementById('silverAmount');
  const bronzeAmount = document.getElementById('bronzeAmount');

  const prizeTotal = 1000; // Example, can get from admin

  if(top3[0]){
    const snap1 = await get(ref(db,'users/'+top3[0].uid));
    goldName.innerText = snap1.exists()? snap1.val().name : top3[0].uid;
    goldAmount.innerText = Math.round(prizeTotal*0.65);
  }
  if(top3[1]){
    const snap2 = await get(ref(db,'users/'+top3[1].uid));
    silverName.innerText = snap2.exists()? snap2.val().name : top3[1].uid;
    silverAmount.innerText = Math.round(prizeTotal*0.25);
  }
  if(top3[2]){
    const snap3 = await get(ref(db,'users/'+top3[2].uid));
    bronzeName.innerText = snap3.exists()? snap3.val().name : top3[2].uid;
    bronzeAmount.innerText = Math.round(prizeTotal*0.1);
  }
}

loadMedals();
setInterval(loadMedals,5000); // refresh every 5 sec
</script>
</body>
</html>
